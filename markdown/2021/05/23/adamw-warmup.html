<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>I was confused about AdamW and Adam + Warm Up | Sajjad Ayoubi‚Äôs Blog üòâ</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="I was confused about AdamW and Adam + Warm Up" />
<meta name="author" content="Sajjad Ayoubi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is what I have found out" />
<meta property="og:description" content="This is what I have found out" />
<link rel="canonical" href="https://sajjjadayobi.github.io/blog/markdown/2021/05/23/adamw-warmup.html" />
<meta property="og:url" content="https://sajjjadayobi.github.io/blog/markdown/2021/05/23/adamw-warmup.html" />
<meta property="og:site_name" content="Sajjad Ayoubi‚Äôs Blog üòâ" />
<meta property="og:image" content="https://sajjjadayobi.github.io/blog/images/persian_qa.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-23T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://sajjjadayobi.github.io/blog/markdown/2021/05/23/adamw-warmup.html","@type":"BlogPosting","headline":"I was confused about AdamW and Adam + Warm Up","dateModified":"2021-05-23T00:00:00-05:00","datePublished":"2021-05-23T00:00:00-05:00","image":"https://sajjjadayobi.github.io/blog/images/persian_qa.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://sajjjadayobi.github.io/blog/markdown/2021/05/23/adamw-warmup.html"},"author":{"@type":"Person","name":"Sajjad Ayoubi"},"description":"This is what I have found out","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://sajjjadayobi.github.io/blog/feed.xml" title="Sajjad Ayoubi's Blog üòâ" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Sajjad Ayoubi&#39;s Blog üòâ</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">I was confused about AdamW and Adam + Warm Up</h1><p class="page-description">This is what I have found out</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-05-23T00:00:00-05:00" itemprop="datePublished">
        May 23, 2021
      </time>
       ‚Ä¢ <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#markdown">markdown</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#i-was-confused-about-adamw-and-adam--warm-up">I was confused about AdamW and Adam + Warm Up</a>
<ul>
<li class="toc-entry toc-h2"><a href="#warm-up-is-a-learning-rate-scheduler">Warm Up is a learning Rate Scheduler</a></li>
<li class="toc-entry toc-h2"><a href="#adamw-is-adam-with-correct-weight-decay">AdamW is Adam with correct Weight Decay</a></li>
</ul>
</li>
</ul><h1 id="i-was-confused-about-adamw-and-adam--warm-up">
<a class="anchor" href="#i-was-confused-about-adamw-and-adam--warm-up" aria-hidden="true"><span class="octicon octicon-link"></span></a>I was confused about AdamW and Adam + Warm Up</h1>

<p>This is what I have found out</p>

<h2 id="warm-up-is-a-learning-rate-scheduler">
<a class="anchor" href="#warm-up-is-a-learning-rate-scheduler" aria-hidden="true"><span class="octicon octicon-link"></span></a>Warm Up is a learning Rate Scheduler</h2>

<p>Warm up steps are just a few updates with low learning rate at the beginning of training. After this <strong>warm up</strong>, you use the regular learning rate (schedule) to train your model to convergence.</p>

<p>The idea that this helps your network to slowly adapt to the data intuitively makes sense. However, theoretically, the main reason for warm up steps is to allow adaptive optimizers (e.g. Adam, RMSProp, ‚Ä¶) to compute correct statistics of the gradients. Therefore, a warm up period makes little sense when training with plain SGD.</p>

<p>If your data set is highly differentiated, you can suffer from a sort of ‚Äúearly over-fitting‚Äù. If your shuffled data happens to include a cluster of related, strongly-featured observations, your model‚Äôs initial training can skew badly toward those features ‚Äì or worse, toward incidental features that aren‚Äôt truly related to the topic at all.</p>

<p>Warm-up is a way to reduce the primacy effect of the early training examples. Without it, you may need to run a few extra epochs to get the convergence desired, as the model un-trains those early superstitions.</p>

<p>Many models afford this as a command-line option. The learning rate is increased linearly over the warm-up period. If the target learning rate is <code class="language-plaintext highlighter-rouge">p</code> and the warm-up period is <code class="language-plaintext highlighter-rouge">n</code>, then the first batch iteration uses <code class="language-plaintext highlighter-rouge">1*p/n</code> for its learning rate; the second uses <code class="language-plaintext highlighter-rouge">2*p/n</code>, and so on: iteration <code class="language-plaintext highlighter-rouge">i</code> uses <code class="language-plaintext highlighter-rouge">i*p/n</code>, until we hit the nominal rate at iteration <code class="language-plaintext highlighter-rouge">n</code>. this means that the first iteration gets only 1/n of the primacy effect. This does a reasonable job of balancing that influence. for example Bert use liner Warm Up with linear decay /\</p>

<h2 id="adamw-is-adam-with-correct-weight-decay">
<a class="anchor" href="#adamw-is-adam-with-correct-weight-decay" aria-hidden="true"><span class="octicon octicon-link"></span></a>AdamW is Adam with correct Weight Decay</h2>

<p>In general, Adam needs more regularization than SGD, L2 and weight decay are the same in just Vanilla SGD, not in algorithms that use momentum. Weight decay is just in backward pass and added to the gradients but L2 add directly in loss function
<a href="https://arxiv.org/abs/1711.05101">AdamW</a> paper shows that weight decay work better in the case of Adam, but the implementation of Adam with weight decay was wrong during these years. in this paper, they fixed it.</p>

<ul>
  <li>
<strong>W</strong> stands for weight decay</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="n">AdamW</span><span class="p">(</span><span class="n">net</span><span class="p">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</code></pre></div></div>

<p>When weight decay is 0, there is no difference between Adam and AdamW.</p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="sajjjadayobi/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/markdown/2021/05/23/adamw-warmup.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Sajjad Ayoubi</li>
          <li><a class="u-email" href="mailto:sadeveloper360@gmail.com">sadeveloper360@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/sajjjadayobi" title="sajjjadayobi"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/ayoubi_sajjad" title="ayoubi_sajjad"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
